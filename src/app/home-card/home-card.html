<article>
  <app-card [headerClass]="headerClass()">
    <ng-container cardTitle>
      @if (singleItem()) {
        {{ singleItem()!.label | addTitleToLabel: data().title }}
      } @else {
        {{ data().title }}
      }
    </ng-container>

    <ng-container cardAction>
      @if (singleItem()) {
        <app-home-item-icon
          [icon]="singleItem()!.icon"
          [clickableIcon]="!!singleDevice()"
          [activeIcon]="!!singleDevice()?.state"
          (iconClick)="changeDeviceState(singleDevice())"
        ></app-home-item-icon>
      } @else if (showAllDevicesState()) {
        <mat-slide-toggle
          [checked]="allDevicesState()"
          [hideIcon]="true"
          aria-label="Toggle all devices state"
          (change)="changeAllDevicesState()"
        ></mat-slide-toggle>
      }
    </ng-container>

    @if (!singleItem()) {
      <ng-container cardContent>
        <ul class="card-content" [class.card-content-vertical]="isContentVertical()">
          @for (item of data().items; track $index) {
            <li class="card-row">
              @if (item.type === 'sensor') {
                <app-sensor class="card-item" [data]="item" [iconPosition]="iconPosition()">
                  <ng-container *ngTemplateOutlet="sensorValue; context: { itemData: item }"></ng-container>
                </app-sensor>
              } @else if (item.type === 'device') {
                <app-device
                  class="card-item"
                  [data]="item"
                  [iconPosition]="iconPosition()"
                  (changeState)="changeDeviceState(item)"
                ></app-device>
              }
            </li>
          }
        </ul>
      </ng-container>
    } @else {
      <ng-container cardFooter>
        <div class="card-footer body-3">
          @if (singleDevice()) {
            <span class="capitalize" aria-label="State value">{{ singleDevice()!.state | appStateValue }}</span>
          } @else if (singleSensor()) {
            <ng-container *ngTemplateOutlet="sensorValue; context: { itemData: singleSensor() }"></ng-container>
          }
        </div>
      </ng-container>
    }
  </app-card>
</article>

<ng-template #sensorValue let-itemData="itemData">
  <span class="capitalize">{{ itemData.value | appUnits: itemData.icon : sensorTypesWithHiddenAmount }}</span>
</ng-template>
